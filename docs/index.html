<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surrogate-Assisted Feature Extraction in R â€¢ rSAFE</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="dalexverse-2.css" rel="stylesheet">
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Surrogate-Assisted Feature Extraction in R">
<meta property="og:description" content="A model agnostic tool for making an explainable
  white-box model more accurate using alternative black-box model called surrogate model.
  Based on the complicated model, such as neural network or random forest, new features
  are being extracted and then used in the process of fitting a simpler explainable model,
  improving its overall performance.">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="index.html">rSAFE</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.1.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/example_apartments.html">Regression example - apartments data</a>
    </li>
    <li>
      <a href="articles/example_hr.html">Classification example - HR data</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/rSAFE">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="surrogate-assisted-feature-extraction-in-r" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#surrogate-assisted-feature-extraction-in-r" class="anchor"></a>Surrogate Assisted Feature Extraction in R <img src="reference/figures/logo.png" align="right" width="150">
</h1></div>

<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The <code>rSAFE</code> package is a model agnostic tool for making an interpretable white-box model more accurate using alternative black-box model called surrogate model. Based on the complicated model, such as neural network or random forest, new features are being extracted and then used in the process of fitting a simpler interpretable model, improving its overall performance.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The package can be installed from GitHub using the code below:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"ModelOriented/rSAFE"</span>)</a></code></pre></div>
</div>
<div id="demo" class="section level2">
<h2 class="hasAnchor">
<a href="#demo" class="anchor"></a>Demo</h2>
<p>In this vignette we present an example of an application of the <code>rSAFE</code> package in case of regression problems. It is based on <code>apartments</code> and <code>apartmentsTest</code> datasets which come from the <code>DALEX</code> package but are also available in the <code>rSAFE</code> package. We will use these artificial datasets to predict the price per square meter of an apartment based on features such as construction year, surface, floor, number of rooms and district. It should be mentioned that four of these variables are continuous while the fifth one is categorical.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rSAFE)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(apartments)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;   m2.price construction.year surface floor no.rooms    district</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; 1     5897              1953      25     3        1 Srodmiescie</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; 2     1818              1992     143     9        5     Bielany</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; 3     3643              1937      56     1        2       Praga</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; 4     3517              1995      93     7        3      Ochota</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; 5     3013              1992     144     6        5     Mokotow</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 6     5795              1926      61     6        2 Srodmiescie</span></a></code></pre></div>
</div>
<div id="building-a-black-box-model" class="section level2">
<h2 class="hasAnchor">
<a href="#building-a-black-box-model" class="anchor"></a>Building a black-box model</h2>
<p>First we fit a random forest model to the original <code>apartments</code> dataset - this is our complex model that will serve us as a surrogate.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(randomForest)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">111</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">model_rf1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(m2.price <span class="op">~</span><span class="st"> </span>construction.year <span class="op">+</span><span class="st"> </span>surface <span class="op">+</span><span class="st"> </span>floor <span class="op">+</span><span class="st"> </span>no.rooms <span class="op">+</span><span class="st"> </span>district, <span class="dt">data =</span> apartments)</a></code></pre></div>
</div>
<div id="creating-an-explainer" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-an-explainer" class="anchor"></a>Creating an explainer</h2>
<p>We also create an <code>explainer</code> object that will be used later to create new variables and at the end to compare models performance.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DALEX)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">explainer_rf1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(model_rf1, <span class="dt">data =</span> apartmentsTest[<span class="dv">1</span><span class="op">:</span><span class="dv">3000</span>,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>], <span class="dt">y =</span> apartmentsTest[<span class="dv">1</span><span class="op">:</span><span class="dv">3000</span>,<span class="dv">1</span>], <span class="dt">label =</span> <span class="st">"rf1"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">explainer_rf1</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; Model label:  rf1 </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; Model class:  randomForest.formula,randomForest </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; Data head  :</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;      construction.year surface floor no.rooms    district</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 1001              1976     131     3        5 Srodmiescie</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 1002              1978     112     9        4     Mokotow</span></a></code></pre></div>
</div>
<div id="creating-a-safe_extractor" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-safe_extractor" class="anchor"></a>Creating a safe_extractor</h2>
<p>Now, we create a <code>safe_extractor</code> object using <code>rSAFE</code> package and our surrogate model. Setting the argument <code>verbose=FALSE</code> stops progress bar from printing.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">safe_extractor &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rSAFE/man/safe_extraction.html">safe_extraction</a></span>(explainer_rf1, <span class="dt">penalty =</span> <span class="dv">25</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Now, letâ€™s print summary for the new object we have just created.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(safe_extractor)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; Variable 'construction.year' - selected intervals:</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;  (-Inf, 1937]</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;      (1937, 1994]</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt;      (1994, Inf)</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; Variable 'surface' - selected intervals:</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt;  (-Inf, 47]</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;      (47, 101]</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;      (101, Inf)</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; Variable 'floor' - selected intervals:</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;  (-Inf, 5]</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;      (5, Inf)</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; Variable 'no.rooms' - selected intervals:</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;  (-Inf, 3]</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;      (3, Inf)</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; Variable 'district' - created levels:</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;  Bemowo, Bielany, Ursus, Ursynow, Praga, Wola -&gt;  Bemowo_Bielany_Praga_Ursus_Ursynow_Wola </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;  Zoliborz, Mokotow, Ochota -&gt;  Mokotow_Ochota_Zoliborz </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;  Srodmiescie -&gt;  Srodmiescie</span></a></code></pre></div>
<p>We can see transormation propositions for all variables in our dataset.</p>
<p>In the plot below we can see which points have been chosen to be the breakpoints for a particular variable:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(safe_extractor, <span class="dt">variable =</span> <span class="st">"construction.year"</span>)</a></code></pre></div>
<p><img src="README_files/figure-markdown_github/unnamed-chunk-7-1.png"></p>
<p>For factor variables we can observe in which order levels have been merged and what is the optimal clustering:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(safe_extractor, <span class="dt">variable =</span> <span class="st">"district"</span>)</a></code></pre></div>
<p><img src="README_files/figure-markdown_github/unnamed-chunk-8-1.png"></p>
</div>
<div id="transforming-data" class="section level2">
<h2 class="hasAnchor">
<a href="#transforming-data" class="anchor"></a>Transforming data</h2>
<p>Now we can use our <code>safe_extractor</code> object to create new categorical features in the given dataset.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">data1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rSAFE/man/safely_transform_data.html">safely_transform_data</a></span>(safe_extractor, apartmentsTest[<span class="dv">3001</span><span class="op">:</span><span class="dv">6000</span>,], <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table">
<colgroup>
<col width="7%">
<col width="5%">
<col width="10%">
<col width="5%">
<col width="3%">
<col width="5%">
<col width="13%">
<col width="7%">
<col width="6%">
<col width="8%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">district</th>
<th align="right">m2.price</th>
<th align="right">construction.year</th>
<th align="right">surface</th>
<th align="right">floor</th>
<th align="right">no.rooms</th>
<th align="left">construction.year_new</th>
<th align="left">surface_new</th>
<th align="left">floor_new</th>
<th align="left">no.rooms_new</th>
<th align="left">district_new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Bielany</td>
<td align="right">3542</td>
<td align="right">1979</td>
<td align="right">21</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="left">(1937, 1994]</td>
<td align="left">(-Inf, 47]</td>
<td align="left">(5, Inf)</td>
<td align="left">(-Inf, 3]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="even">
<td align="left">Srodmiescie</td>
<td align="right">5631</td>
<td align="right">1997</td>
<td align="right">107</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">(1994, Inf)</td>
<td align="left">(101, Inf)</td>
<td align="left">(-Inf, 5]</td>
<td align="left">(3, Inf)</td>
<td align="left">Srodmiescie</td>
</tr>
<tr class="odd">
<td align="left">Bielany</td>
<td align="right">2989</td>
<td align="right">1994</td>
<td align="right">41</td>
<td align="right">9</td>
<td align="right">2</td>
<td align="left">(1937, 1994]</td>
<td align="left">(-Inf, 47]</td>
<td align="left">(5, Inf)</td>
<td align="left">(-Inf, 3]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="even">
<td align="left">Ursynow</td>
<td align="right">3822</td>
<td align="right">1968</td>
<td align="right">28</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">(1937, 1994]</td>
<td align="left">(-Inf, 47]</td>
<td align="left">(-Inf, 5]</td>
<td align="left">(-Inf, 3]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="odd">
<td align="left">Ursynow</td>
<td align="right">2337</td>
<td align="right">1971</td>
<td align="right">146</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="left">(1937, 1994]</td>
<td align="left">(101, Inf)</td>
<td align="left">(-Inf, 5]</td>
<td align="left">(3, Inf)</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="even">
<td align="left">Ochota</td>
<td align="right">3381</td>
<td align="right">1956</td>
<td align="right">97</td>
<td align="right">8</td>
<td align="right">3</td>
<td align="left">(1937, 1994]</td>
<td align="left">(47, 101]</td>
<td align="left">(5, Inf)</td>
<td align="left">(-Inf, 3]</td>
<td align="left">Mokotow_Ochota_Zoliborz</td>
</tr>
</tbody>
</table>
<p>We can also perform feature selection if we wish. For each original feature it keeps exactly one of their forms - original one or transformed one.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">vars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rSAFE/man/safely_select_variables.html">safely_select_variables</a></span>(safe_extractor, data1, <span class="dt">which_y =</span> <span class="st">"m2.price"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">data1 &lt;-<span class="st"> </span>data1[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"m2.price"</span>, vars)]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(vars)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; [1] "surface"               "floor"                 "no.rooms"             </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; [4] "construction.year_new" "district_new"</span></a></code></pre></div>
<p>It can be observed that for some features the original form was preffered and for others the transformed one.</p>
<p>Here are the first few rows for our data after feature selection:</p>
<table class="table">
<thead><tr class="header">
<th align="right">m2.price</th>
<th align="right">surface</th>
<th align="right">floor</th>
<th align="right">no.rooms</th>
<th align="left">construction.year_new</th>
<th align="left">district_new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3542</td>
<td align="right">21</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="left">(1937, 1994]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="even">
<td align="right">5631</td>
<td align="right">107</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="left">(1994, Inf)</td>
<td align="left">Srodmiescie</td>
</tr>
<tr class="odd">
<td align="right">2989</td>
<td align="right">41</td>
<td align="right">9</td>
<td align="right">2</td>
<td align="left">(1937, 1994]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="even">
<td align="right">3822</td>
<td align="right">28</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">(1937, 1994]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="odd">
<td align="right">2337</td>
<td align="right">146</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="left">(1937, 1994]</td>
<td align="left">Bemowo_Bielany_Praga_Ursus_Ursynow_Wola</td>
</tr>
<tr class="even">
<td align="right">3381</td>
<td align="right">97</td>
<td align="right">8</td>
<td align="right">3</td>
<td align="left">(1937, 1994]</td>
<td align="left">Mokotow_Ochota_Zoliborz</td>
</tr>
</tbody>
</table>
<p>Now, we perform transformations on another data that will be used later in explainers:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">data2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rSAFE/man/safely_transform_data.html">safely_transform_data</a></span>(safe_extractor, apartmentsTest[<span class="dv">6001</span><span class="op">:</span><span class="dv">9000</span>,], <span class="dt">verbose =</span> <span class="ot">FALSE</span>)[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"m2.price"</span>, vars)]</a></code></pre></div>
</div>
<div id="creating-white-box-models-on-original-and-transformed-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-white-box-models-on-original-and-transformed-datasets" class="anchor"></a>Creating white-box models on original and transformed datasets</h2>
<p>Letâ€™s fit the models to data containg newly created columns. We consider a linear model as a white-box model.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">model_lm2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data1)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">explainer_lm2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(model_lm2, <span class="dt">data =</span> data2, <span class="dt">y =</span> apartmentsTest[<span class="dv">6001</span><span class="op">:</span><span class="dv">9000</span>,<span class="dv">1</span>], <span class="dt">label =</span> <span class="st">"lm2"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">111</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">model_rf2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data1)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">explainer_rf2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(model_rf2, data2, apartmentsTest[<span class="dv">6001</span><span class="op">:</span><span class="dv">9000</span>,<span class="dv">1</span>], <span class="dt">label =</span> <span class="st">"rf2"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Moreover, we create a linear model based on original <code>apartments</code> dataset and its corresponding explainer in order to check if our methodology improves results.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">model_lm1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> apartments)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">explainer_lm1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(model_lm1, <span class="dt">data =</span> apartmentsTest[<span class="dv">1</span><span class="op">:</span><span class="dv">3000</span>,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>], <span class="dt">y =</span> apartmentsTest[<span class="dv">1</span><span class="op">:</span><span class="dv">3000</span>,<span class="dv">1</span>], <span class="dt">label =</span> <span class="st">"lm1"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="comparing-models-performance" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-models-performance" class="anchor"></a>Comparing models performance</h2>
<p>Final step is the comparison of all the models we have created.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">mp_lm1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/model_performance.html">model_performance</a></span>(explainer_lm1)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">mp_rf1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/model_performance.html">model_performance</a></span>(explainer_rf1)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">mp_lm2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/model_performance.html">model_performance</a></span>(explainer_lm2)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">mp_rf2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/model_performance.html">model_performance</a></span>(explainer_rf2)</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mp_lm1, mp_rf1, mp_lm2, mp_rf2, <span class="dt">geom =</span> <span class="st">"boxplot"</span>)</a></code></pre></div>
<p><img src="README_files/figure-markdown_github/unnamed-chunk-17-1.png"></p>
<p>In the plot above we can see that the linear model based on transformed features has generally more accurate predictions that the one fitted to the original dataset.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li><a href="https://github.com/ModelOriented/SAFE">Python version of SAFE package</a></li>
<li>
<a href="https://arxiv.org/abs/1902.11035">SAFE article</a> - the article about SAFE algorithm, including benchmark results obtained using Python version of SAFE package</li>
</ul>
<p>The package was created as a part of masterâ€™s diploma thesis at Warsaw University of Technology at Faculty of Mathematics and Information Science by Anna Gierlak.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/ModelOriented/rSAFE">https://â€‹github.com/â€‹ModelOriented/â€‹rSAFE</a>
</li>
<li>Report a bug at <br><a href="https://github.com/ModelOriented/rSAFE/issues">https://â€‹github.com/â€‹ModelOriented/â€‹rSAFE/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Anna Gierlak <br><small class="roles"> Author, maintainer </small>  </li>
<li>Przemyslaw Biecek <br><small class="roles"> Author, thesis advisor </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/ModelOriented/rSAFE"><img src="https://travis-ci.org/ModelOriented/rSAFE.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://codecov.io/gh/ModelOriented/rSAFE"><img src="https://codecov.io/gh/ModelOriented/rSAFE/branch/master/graph/badge.svg" alt="Coverage Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="author">
  <p>
    Developed by Anna Gierlak, Przemyslaw Biecek.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
